// This file is generated by codegen/index.ts
// Do not edit this file manually
import { Command, Option } from 'clipanion'

export abstract class BaseTypegenCommand extends Command {
  static paths = [['typegen']]

  static usage = Command.Usage({
    description:
      'Generate TypeScript type definitions from #[napi]-annotated Rust source files',
    details:
      'This command statically analyzes Rust source files and produces TypeScript definitions. Unlike `napi build`, it does not invoke `cargo build` — it parses `.rs` files directly, making it significantly faster for type-only regeneration.',
    examples: [
      ['Generate types for the current directory', 'napi typegen'],
      [
        'Generate types for a specific crate into a dist folder',
        'napi typegen --crate-dir ./my-crate --output-dir ./dist',
      ],
      [
        'Generate types with a custom filename',
        'napi typegen --dts index.d.cts',
      ],
      ['Strict mode — fail on first conversion error', 'napi typegen --strict'],
    ],
  })

  cwd?: string = Option.String('--cwd', {
    description:
      'The working directory of where napi command will be executed in, all other paths options are relative to this path',
  })

  configPath?: string = Option.String('--config-path,-c', {
    description: 'Path to `napi` config json file',
  })

  packageJsonPath?: string = Option.String('--package-json-path', {
    description: 'Path to `package.json`',
  })

  crateDir?: string = Option.String('--crate-dir', {
    description:
      'Root directory of the Rust crate to scan. Defaults to the current working directory.',
  })

  outputDir?: string = Option.String('--output-dir,-o', {
    description:
      'Path to where the generated .d.ts file will be written. Default to the crate folder.',
  })

  dts = Option.String('--dts', 'index.d.ts', {
    description:
      'Filename of the generated type definition file. Relative to `--output-dir`.',
  })

  dtsHeader?: string = Option.String('--dts-header', {
    description: 'Custom file header for generated type def file.',
  })

  noDtsHeader?: boolean = Option.Boolean('--no-dts-header', {
    description:
      'Whether to disable the default file header for generated type def file.',
  })

  constEnum?: boolean = Option.Boolean('--const-enum', {
    description: 'Whether generate const enum for typescript bindings',
  })

  napiTypegen?: string = Option.String('--napi-typegen', {
    description:
      'Path to napi-typegen binary (overrides native addon). If unset, uses @napi-rs/typegen addon or falls back to napi-typegen in PATH.',
  })

  strict = Option.Boolean('--strict', false, {
    description:
      'Fail on the first item that cannot be converted instead of skipping it.',
  })

  getOptions() {
    return {
      cwd: this.cwd,
      configPath: this.configPath,
      packageJsonPath: this.packageJsonPath,
      crateDir: this.crateDir,
      outputDir: this.outputDir,
      dts: this.dts,
      dtsHeader: this.dtsHeader,
      noDtsHeader: this.noDtsHeader,
      constEnum: this.constEnum,
      napiTypegen: this.napiTypegen,
      strict: this.strict,
    }
  }
}

/**
 * Generate TypeScript type definitions from #[napi]-annotated Rust source files
 */
export interface TypegenOptions {
  /**
   * The working directory of where napi command will be executed in, all other paths options are relative to this path
   */
  cwd?: string
  /**
   * Path to `napi` config json file
   */
  configPath?: string
  /**
   * Path to `package.json`
   */
  packageJsonPath?: string
  /**
   * Root directory of the Rust crate to scan. Defaults to the current working directory.
   */
  crateDir?: string
  /**
   * Path to where the generated .d.ts file will be written. Default to the crate folder.
   */
  outputDir?: string
  /**
   * Filename of the generated type definition file. Relative to `--output-dir`.
   *
   * @default 'index.d.ts'
   */
  dts?: string
  /**
   * Custom file header for generated type def file.
   */
  dtsHeader?: string
  /**
   * Whether to disable the default file header for generated type def file.
   */
  noDtsHeader?: boolean
  /**
   * Whether generate const enum for typescript bindings
   */
  constEnum?: boolean
  /**
   * Path to napi-typegen binary (overrides native addon). If unset, uses @napi-rs/typegen addon or falls back to napi-typegen in PATH.
   */
  napiTypegen?: string
  /**
   * Fail on the first item that cannot be converted instead of skipping it.
   *
   * @default false
   */
  strict?: boolean
}

export function applyDefaultTypegenOptions(options: TypegenOptions) {
  return {
    dts: 'index.d.ts',
    strict: false,
    ...options,
  }
}
